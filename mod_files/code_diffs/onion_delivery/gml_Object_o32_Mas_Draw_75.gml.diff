*** original_scripts/onion_delivery/gml_Object_o32_Mas_Draw_75.gml	Thu Jan  1 00:00:00 1970
--- ufo50_modded_scripts/onion_delivery/gml_Object_o32_Mas_Draw_75.gml	Sun Nov  9 18:12:29 2025
***************
*** 0 ****
--- 1,515 ----
+ 
+ if (blackout)
+ {
+     draw_clear_alpha(c_black, 1);
+     exit;
+ }
+ 
+ if (state == GAMESTATE_MENU) {
+     display_set_gui_size(384, 216);
+     draw_set_color(global.palette[31]);
+     draw_set_alpha(0.65);
+     draw_rectangle(0, 0, 384, 240, false);
+     draw_set_alpha(1);
+     draw_set_color(c_white);
+     scrSetFont(global.fontTall);
+     scrSetFont(global.fontDefault);
+ 
+     draw_text(150, 24, "GAME OPTIONS");
+     scrSetFont(global.fontDefault);
+ 
+     draw_text(50, 80, "STARTING TIME:");
+     var startingTimeText = string(startingTimeOptions[currentStartingTimeSelect]);
+     draw_text(210, 80, startingTimeText);
+ 
+     draw_text(50, 96, "TARGET ONIONS:");
+     var targetOnionsText = string(onionsDeliveredGoal);
+     draw_text(210, 96, targetOnionsText);
+ 
+     draw_text(50, 112, "PER ONION TIME:");
+     draw_text(210, 112, string(TIMER_BONUS_DROPOFF));
+ 
+     draw_text(50, 128, "CRATE TIME:");
+     draw_text(210, 128, string(TIMER_BONUS_CRATE));
+ 
+     draw_text(50, 144, "RETURN TIME:");
+     draw_text(210, 144, string(TIMER_BONUS_FINAL));
+ 
+     draw_text(50, 160, "SPECIFY EVENT:");
+     var dayEventText = "ANY";
+     if (dayEventCustom >= 0) {
+         dayEventText = dayEventOptions[dayEventCustom];
+     }
+     draw_text(210, 160, dayEventText);
+ 
+     draw_text(50, 176, "EVENT SCALING PER PLAYER:");
+     var eventScaleString = "False";
+     if (dayEventMultiplierActive)
+         eventScaleString = "True";
+     draw_text(260, 176, eventScaleString);
+ 
+     draw_text(50, 192, "START");
+     
+     if (scrTransitionDone())
+     {
+         carIconPos = 85 + (titleY * 16);
+         draw_sprite_ext(s32_pCar, 0, 34, carIconPos, 1, 1, 0, c_white, 1);
+     }
+     exit;
+ }
+ 
+ if (state == GAMESTATE_INTRO)
+ {
+     display_set_gui_size(384, 216);
+     draw_clear_alpha(c_black, 1);
+     
+     if (subState < 6)
+     {
+         var _yDraw = 0;
+         
+         if (subState == 2)
+             _yDraw += scrChoose(-1, 1);
+         
+         draw_sprite(s32_cutIntro, subState, 0, _yDraw);
+     }
+     
+     exit;
+ }
+ 
+ if (state == GAMESTATE_ENDING)
+ {
+     display_set_gui_size(384, 216);
+     draw_clear_alpha(c_black, 1);
+     
+     if (subState < 7)
+     {
+         draw_sprite(s32_cutEnd, subState, 0, 0);
+     }
+     else
+     {
+         if (onionsTotal < onionCherryGoal)
+             draw_sprite(s32_cutEnd, 7, 0, 0);
+         else
+             draw_sprite(s32_cutEnd, 8, 0, 0);
+         
+         var tx = 64;
+         
+         for (var n = 0; n < 25; n++)
+         {
+             var _yDraw = floor(creditsY + (8 * n));
+             draw_text(tx, _yDraw, scrStringManual("game_credits_32_" + string(n + 1), 0));
+         }
+     }
+     
+     exit;
+ }
+ 
+ if (state == GAMESTATE_NEWS)
+ {
+     display_set_gui_size(384, 216);
+     draw_clear_alpha(c_black, 1);
+     var _xNews = 72;
+     var _yNews = 24;
+     var _anchorFace = lerp(anchorFace, 3, dayPreview < 20);
+     var _daytext = scrStringSplit(dayText[dayEvent], 30, 5);
+     
+     if (metaTrigger)
+         _daytext = string_line_breaks(scrStringManual("game_meta_message_32", 0), 30, 5);
+     
+     draw_sprite(s32_NewsBackground, 0, _xNews, _yNews);
+     draw_sprite(s32_NewsAlert, eventNewsImage[dayEvent], _xNews + 16, _yNews + 16);
+     draw_sprite(s32_NewsAnchor, _anchorFace, _xNews + 136, _yNews + 16);
+     scrSetFont(global.fontTall);
+     draw_text(_xNews + 188, _yNews + 16, scrString("day") + string(dayNumber + 1));
+     scrSetFont(global.fontDefault);
+     
+     for (var i = 0; i < 5; i++)
+     {
+         var _y = _yNews + 136 + (i * 8);
+         var _string = string_copy(_daytext[i], 1, string_length(_daytext[i]) * ((800 - (i * 50) - (dayPreview * 2)) / 50));
+         draw_text(_xNews, _y, _string);
+     }
+     
+     exit;
+ }
+ 
+ var totalViewPorts = 1;
+ 
+ var guiResX = 384;
+ var guiResY = 216;
+ 
+ var resultsOffsetX = 0; 
+ var resultsOffsetY = 0;
+ 
+ if (global.numPlayers >= 2) {
+     guiResX = 384 * 2;
+     guiResY = 216 * 2;
+     resultsOffsetX = 150; 
+     resultsOffsetY = 110;
+ }
+ 
+ display_set_gui_size(guiResX, guiResY);
+ 
+ 
+ if (oScreenHandler.splitScreenOn) {
+     totalViewPorts = 4;
+ }
+ 
+ 
+ for (var viewPortIndex = 0; viewPortIndex < totalViewPorts; viewPortIndex++) {
+     if (viewPortIndex >= global.numPlayers || viewPortIndex >= array_length(players))
+         continue;
+ 
+     var _xv = view_get_xport(viewPortIndex) * 2;
+     var _yv = view_get_yport(viewPortIndex) * 2;
+ 
+     var player = -4;
+ 
+ 
+     if (instance_exists(players[viewPortIndex])) {
+         player = players[viewPortIndex];
+     } 
+ 
+ 
+     if (returnToBase && state == GAMESTATE_PLAY && onionsDelivered[dayNumber] == onionsDeliveredGoal)
+     {
+         draw_rectangle_color(_xv + 96, (_yv + 216) - 24, _xv + 384, (_yv + 216) - 8, c_black, c_black, c_black, c_black, 0);
+         var _xText = (_xv + 384) - ((((current_time * 0.1) % 672) div 8) * 8);
+         var _yText = (_yv + 216) - 24;
+         scrSetFont(global.fontTall);
+         draw_text(_xText, _yText, scrString("day_end"));
+         scrSetFont(global.fontDefault);
+     }
+ 
+     draw_sprite(bg32_OnionHud, 0, _xv, _yv);
+     var _sPortrait = -4;
+     var _iPortrait = 0;
+     var statePortrait = statePortraits[viewPortIndex];
+ 
+     if (statePortrait == PORTRAIT_STATIC)
+     {
+         _sPortrait = s32_PortraitStatic;
+         _iPortrait = stepPortraits[viewPortIndex];
+     }
+     else if (statePortrait == PORTRAIT_DRIVE)
+     {
+         _sPortrait = s32_Portrait;
+         
+         if (turnPortrait[viewPortIndex] == -1)
+             _iPortrait = 1;
+         else if (turnPortrait[viewPortIndex] == 1)
+             _iPortrait = 2;
+     }
+     else if (statePortrait == PORTRAIT_REVERSE)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 3;
+     }
+     else if (statePortrait == PORTRAIT_BONK)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 4;
+     }
+     else if (statePortrait == PORTRAIT_IN_AIR_UP)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 5;
+     }
+     else if (statePortrait == PORTRAIT_IN_AIR_DOWN)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 6;
+     }
+     else if (statePortrait == PORTRAIT_ON_FIRE)
+     {
+         _sPortrait = s32_PortraitFire1;
+         _iPortrait = stepPortraits[viewPortIndex];
+     }
+     else if (statePortrait == PORTRAIT_DROWN)
+     {
+         if (stepPortraits[viewPortIndex] < 3)
+         {
+             _sPortrait = s32_PortraitDrown;
+             _iPortrait = stepPortraits[viewPortIndex];
+         }
+     }
+     else if (statePortrait == PORTRAIT_POWERUP)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 7;
+     }
+     else if (statePortrait == PORTRAIT_DELIVERY)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 8;
+     }
+     else if (statePortrait == PORTRAIT_VICTORY)
+     {
+         _sPortrait = s32_Portrait;
+         _iPortrait = 9;
+     }
+ 
+     if (_sPortrait != -4)
+         draw_sprite(_sPortrait, _iPortrait, _xv + 24, _yv + 16);
+ 
+     if (!endTrig && global.cheatID != 1)
+     {
+         var _time = displayTimer;
+         scrSetFont(global.fontTall);
+         
+         if (_time < 10)
+             draw_set_color(global.palette[9]);
+         
+         var strTime = string_format(_time, 2, 0);
+         strTime = string_replace_all(strTime, " ", "0");
+         draw_text(_xv + 16, _yv + 72, strTime);
+         scrSetFont(global.fontDefault);
+         draw_set_color(global.palette[0]);
+     }
+ 
+     draw_sprite(s32_Onion, 0, _xv + 12, _yv + 100);
+     var strDeliveryPart = string_format(onionsDelivered[dayNumber], 2, 0);
+     strDeliveryPart = string_replace_all(strDeliveryPart, " ", "0");
+     var strDeliveryGoal = string_format(onionsDeliveredGoal, 2, 0);
+     strDeliveryGoal = string_replace_all(strDeliveryGoal, " ", "0");
+     strDeliveryGoal = "/" + strDeliveryGoal;
+     draw_text(_xv + 16, _yv + 96, strDeliveryPart);
+ 
+     if (global.cheatID != 1)
+         draw_text(_xv + 8, _yv + 104, strDeliveryGoal);
+ 
+     if (instance_exists(player))
+     {
+         for (var i = 0; i < player.lifeMax; i++)
+         {
+             if (i < player.life)
+             {
+                 draw_sprite(s32_OnionHealth, 5, _xv + 44, (_yv + 96) - (16 * i));
+             }
+             else if (i == player.life && player.lifeCharging && global.halfTime)
+             {
+                 var oImg = ((player.lifeCharge / player.lifeChargeMax) * 4) + 1;
+                 draw_sprite(s32_OnionHealth, oImg, _xv + 44, (_yv + 96) - (16 * i));
+             }
+         }
+         
+         var speedNotch = floor((abs(player.dSpeed) / (player.dSpeedMaxTrue - 0.2)) * 7);
+         speedNotch = min(speedNotch, 7);
+         
+         for (var i = 1; i <= speedNotch; i++)
+         {
+             var img = 0;
+             
+             if (i > 5)
+                 img = 2;
+             else if (i > 3)
+                 img = 1;
+             
+             draw_sprite(s32_HudSpeed, img, _xv + 68, (_yv + 112) - (i * 4));
+         }
+         
+         var lightImg = 0;
+         
+         if (player.lifeCharging)
+             lightImg = 1;
+         
+         draw_sprite(s32_HudLight, lightImg, _xv + 68, _yv + 68);
+     }
+ 
+     draw_text(_xv + 16, _yv + 120, checkpointActiveName1);
+     draw_text(_xv + 16, _yv + 128, checkpointActiveName2);
+     var _checkpointID = checkpointID[checkpointActive];
+ 
+     if (instance_exists(_checkpointID) && instance_exists(player) && !endTrig)
+     {
+         var _xCheckpoint = player.x + scr32_DeltaWrap(player.x, _checkpointID.x);
+         var _yCheckpoint = player.y + scr32_DeltaWrap(player.y, _checkpointID.y);
+         var _CheckpointDirection = point_direction(player.x, player.y, _xCheckpoint, _yCheckpoint);
+         var _CheckpointDistance = point_distance(player.x, player.y, _xCheckpoint, _yCheckpoint);
+         var _xRadarCenter = _xv + 48;
+         var _yRadarCenter = _yv + 176;
+         var _RadarDistance = min(_CheckpointDistance * 0.04, 24);
+         var _xRadarPoint = round(_xRadarCenter + lengthdir_x(_RadarDistance, _CheckpointDirection));
+         var _yRadarPoint = round(_yRadarCenter + lengthdir_y(_RadarDistance, _CheckpointDirection));
+         draw_sprite(s32_RadarPoint, (current_time div 100) % 2, _xRadarPoint, _yRadarPoint);
+         var _drawPointer = false;
+         
+         if (tPointer > 0 && (tPointer > 30 || global.halfTime) && onionsDelivered[dayNumber] != 5)
+             _drawPointer = true;
+         
+         if (_CheckpointDistance < 256)
+             _drawPointer = true;
+         
+         if (_drawPointer)
+         {
+             var _yPointer = round(player.y + lengthdir_y(20, _CheckpointDirection));
+             var _xPointer = round(player.x + lengthdir_x(20, _CheckpointDirection));
+             draw_sprite(s32_Pointer, round(_CheckpointDirection / 45), _xPointer, _yPointer);
+         }
+         
+         if (returnToBase)
+         {
+             _checkpointID = checkpointID[0];
+             _xCheckpoint = player.x + scr32_DeltaWrap(player.x, _checkpointID.x);
+             _yCheckpoint = player.y + scr32_DeltaWrap(player.y, _checkpointID.y);
+             _CheckpointDirection = point_direction(player.x, player.y, _xCheckpoint, _yCheckpoint);
+             _CheckpointDistance = point_distance(player.x, player.y, _xCheckpoint, _yCheckpoint);
+             _RadarDistance = min(_CheckpointDistance * 0.04, 24);
+             _xRadarPoint = round(_xRadarCenter + lengthdir_x(_RadarDistance, _CheckpointDirection));
+             _yRadarPoint = round(_yRadarCenter + lengthdir_y(_RadarDistance, _CheckpointDirection));
+             draw_sprite(s32_RadarPointHome, (current_time div 100) % 2, _xRadarPoint, _yRadarPoint);
+         }
+         
+         if (returnToBase)
+         {
+             _drawPointer = false;
+             
+             if (tPointer > 0 && (tPointer > 30 || global.halfTime) && onionsDelivered[dayNumber] == onionsDeliveredGoal)
+                 _drawPointer = true;
+             
+             if (_CheckpointDistance < 256)
+                 _drawPointer = true;
+             
+             if (_drawPointer)
+             {
+                 var _yPointer = round(player.y + lengthdir_y(20, _CheckpointDirection));
+                 var _xPointer = round(player.x + lengthdir_x(20, _CheckpointDirection));
+                 draw_sprite(s32_PointerHome, round(_CheckpointDirection / 45), _xPointer, _yPointer);
+             }
+         }
+     }
+     if (showDebugInfo)
+     {
+         with (oPlayer)
+         {
+             var _x = (_xv + 384) - 88;
+             draw_text(_x, _yv + 8, "STATE " + string(state));
+             draw_text(_x, _yv + 16, "HP    " + string(life));
+             draw_text(_x, _yv + 24, "CHRG  " + string(lifeCharge));
+             draw_text(_x, _yv + 40, "DSPD  " + string(dSpeed));
+             draw_text(_x, _yv + 48, "SSPD  " + string(sSpeed));
+             draw_text(_x, _yv + 56, "ZSPD  " + string(zSpeed));
+             draw_text(_x, _yv + 72, "DIR   " + string(dir));
+             draw_text(_x, _yv + 80, "DIRA  " + string(dirAim));
+             draw_text(_x, _yv + 88, "DIRS  " + string(dirSlide));
+             draw_text(_x + 8, (_yv + 224) - 56, "X  " + string(x));
+             draw_text(_x + 8, (_yv + 224) - 48, "Y  " + string(y));
+             draw_text(_x + 8, (_yv + 224) - 32, "XX " + string(xx));
+             draw_text(_x + 8, (_yv + 224) - 24, "YY " + string(yy));
+         }
+     }
+ 
+     if (godMode && global.cheatID != 1)
+         draw_text(_xv + 16, _yv, "GOD MODE");
+ }
+ 
+ 
+ if (state == GAMESTATE_DAY_START)
+ {
+     if ((tTextBlink % 24) < 12)
+     {
+         scrSetFont(global.fontTall);
+         draw_text_ce(resultsOffsetX + 240, resultsOffsetY + 48, scrStringVal("intro_day_x", dayNumber + 1), 4);
+         draw_text_ce(resultsOffsetX + 240, resultsOffsetY + 64, scrStringVal("intro_get_ready", dayNumber + 1), 4);
+         scrSetFont(global.fontDefault);
+     }
+ }
+ 
+ if (state == GAMESTATE_DEATH)
+ {
+     var _x = resultsOffsetX + 160;
+     var _y = (resultsOffsetY + 108) - 8;
+     var _w = 160;
+     scrSetFont(global.fontTall);
+     
+     if (continues >= 1)
+         scrDrawTextCentered(scrStringVal("lives_left", continues), _x, _y, 8, _w);
+     else
+         scrDrawTextCentered(scrString("game_over"), _x, _y, 8, _w);
+     
+     scrSetFont(global.fontDefault);
+ }
+ else if (state == GAMESTATE_GAME_OVER)
+ {
+     var _x = resultsOffsetX + 160;
+     var _y = resultsOffsetY + 32;
+     var _w = 160;
+     scrDrawMenuBorder(_x, _y, _w, 160);
+     scrDrawTextCentered(scrString("onions_summary"), _x, _y + 8, 8, _w);
+     
+     for (var i = 0; i < 7; i++)
+     {
+         if (i > dayNumber)
+             draw_set_color(global.palette[9]);
+         
+         draw_text(_x + 8, _y + (16 * i) + 24, scrStringFormat(scrString("day_tally"), string(i + 1)));
+         
+         if (i < dayNumber)
+         {
+             var strOnionCount = string_format(onionsDelivered[i], 2, 0);
+             strOnionCount = string_replace_all(strOnionCount, " ", "0");
+             draw_text(_x + 64, _y + (16 * i) + 24, strOnionCount);
+             var _onionct = onionsDelivered[i];
+             
+             for (var a = 0; a < _onionct; a++)
+             {
+                 var ax = _x + 80 + ((a % 8) * 8) + (((a div 8) % 2) * 5);
+                 var ay = (_y + (16 * i) + 28 + ((a div 8) * 4)) - ((_onionct div 8) * 2);
+                 draw_sprite(s32_Onion, 0, ax + 8, ay);
+             }
+         }
+         else if (i == dayNumber)
+         {
+             draw_sprite(s32_Skull, 0, _x + 64, _y + 24 + (16 * i));
+         }
+     }
+     
+     draw_set_color(global.palette[0]);
+     scrSetFont(global.fontTall);
+     var strOnionTotal = string_format(onionsTotal, 3, 0);
+     strOnionTotal = string_replace_all(strOnionTotal, " ", "0");
+     strOnionTotal = scrString("onions_total") + strOnionTotal;
+     scrDrawTextCenteredPoint(strOnionTotal, resultsOffsetX + 240, resultsOffsetY + 168, 8);
+     scrSetFont(global.fontDefault);
+ }
+ else if (state == GAMESTATE_VICTORY)
+ {
+     var _x = resultsOffsetX + 160;
+     var _y = (resultsOffsetY + 108) - 8;
+     var _w = 160;
+     scrSetFont(global.fontTall);
+     scrDrawTextCentered(scrString("game_win"), _x, _y, 8, _w);
+     scrSetFont(global.fontDefault);
+ }
+ else if (state == GAMESTATE_SUMMARY)
+ {
+     var _x = resultsOffsetX + 160;
+     var _y = resultsOffsetY + 32;
+     var _w = 160;
+     scrDrawMenuBorder(_x, _y, _w, 160);
+     scrDrawTextCentered(scrString("onions_summary"), _x, _y + 8, 8, _w);
+     
+     for (var i = 0; i < 7; i++)
+     {
+         draw_text(_x + 8, _y + (16 * i) + 24, scrStringFormat(scrString("day_tally"), string(i + 1)));
+         var strOnionCount = string_format(onionsDelivered[i], 2, 0);
+         strOnionCount = string_replace_all(strOnionCount, " ", "0");
+         draw_text(_x + 64, _y + (16 * i) + 24, strOnionCount);
+         var _onionct = onionsDelivered[i];
+         
+         for (var a = 0; a < _onionct; a++)
+         {
+             var ax = _x + 80 + ((a % 8) * 8) + (((a div 8) % 2) * 5);
+             var ay = (_y + (16 * i) + 28 + ((a div 8) * 4)) - ((_onionct div 8) * 2);
+             draw_sprite(s32_Onion, 0, ax + 8, ay);
+         }
+     }
+     
+     draw_set_color(global.palette[0]);
+     scrSetFont(global.fontTall);
+     var strOnionTotal = string_format(onionsTotal, 3, 0);
+     strOnionTotal = string_replace_all(strOnionTotal, " ", "0");
+     strOnionTotal = scrString("onions_total") + strOnionTotal;
+     scrDrawTextCenteredPoint(strOnionTotal, resultsOffsetX + 240, resultsOffsetY + 168, 8);
+     scrSetFont(global.fontDefault);
+ }
